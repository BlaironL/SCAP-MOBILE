<ion-header class="ion-no-border">
  <ion-toolbar class="dashboard-toolbar">
    <ion-buttons slot="start">
      <ion-menu-button color="light" auto-hide="false"></ion-menu-button>
    </ion-buttons>
    
    <ion-buttons slot="end">
      <ion-button color="light" (click)="setOpen(true)">
        <ion-icon slot="icon-only" name="notifications-outline"></ion-icon>
        <ion-badge color="danger" *ngIf="(totalPendencias$ | async) as total">
          {{ total }}
        </ion-badge>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="welcome-header">
    <div class="welcome-content">
      <h2>Olá, Blairon!</h2>
      <p>Gerencie seus eventos e projetos acadêmicos.</p>
    </div>
  </div>

  <div class="stats-container">
    <ion-grid>
      
      <ion-row>
        <ion-col size="6">
          <div class="stat-card">
            <div class="icon-circle blue">
              <ion-icon name="calendar-outline"></ion-icon>
            </div>
            <div class="stat-info">
              <h3>{{ totalEventosAtivos$ | async }}</h3>
              <p>Ativos</p>
            </div>
          </div>
        </ion-col>

        <ion-col size="6">
          <div class="stat-card" routerLink="/meus-projetos">
            <div class="icon-circle green">
              <ion-icon name="document-text-outline"></ion-icon>
            </div>
            <div class="stat-info">
              <h3>{{ (meusProjetos$ | async)?.length || 0 }}</h3>
              <p>Projetos</p>
            </div>
          </div>
        </ion-col>
      </ion-row>

      <ion-row>
        
        <ion-col size="6">
          <div class="stat-card" routerLink="/avaliar">
            <div class="icon-circle orange">
              <ion-icon name="time-outline"></ion-icon>
            </div>
            <div class="stat-info">
              <h3>{{ totalPendencias$ | async }}</h3>
              <p>Avaliar</p>
            </div>
          </div>
        </ion-col>

        <ion-col size="6">
          <div class="stat-card" routerLink="/gerenciar-eventos">
            <div class="icon-circle purple">
              <ion-icon name="settings-outline"></ion-icon>
            </div>
            <div class="stat-info">
              <h3>Admin</h3>
              <p>Gerenciar</p>
            </div>
          </div>
        </ion-col>

      </ion-row>
    </ion-grid>
  </div>

  <div class="section-title">
    <h3>Próximos Eventos</h3>
    <ion-button fill="clear" size="small">Ver todos</ion-button>
  </div>

  <div class="event-list">
    <ion-card *ngFor="let evento of eventos$ | async" class="event-card">
      <div class="event-row">
        <div class="date-box">
          <span class="day">{{ evento.data | date:'dd' }}</span>
          <span class="month">{{ evento.data | date:'MMM' | uppercase }}</span>
        </div>
        <div class="event-details">
          <h4>{{ evento.titulo }}</h4>
          <p class="location">
            <ion-icon name="location-outline"></ion-icon>
            {{ evento.local }}
          </p>
        </div>
        <div class="status-indicator" [class.active]="evento.status === 'Aberto'">
          {{ evento.status }}
        </div>
      </div>
    </ion-card>
  </div>

  <ion-modal [isOpen]="isModalOpen" (didDismiss)="setOpen(false)" [initialBreakpoint]="0.5" [breakpoints]="[0, 0.5, 0.8]">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Notificações</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="setOpen(false)">Fechar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>
      <ion-content class="ion-padding">
        <ion-list lines="none">
          <ion-item *ngFor="let notif of notificacoes$ | async" class="notif-item">
            <ion-label class="ion-text-wrap">
              <p>{{ notif.mensagem }}</p>
            </ion-label>
            
            <div slot="end" *ngIf="notif.tipo === 'solicitacao_projeto'" style="display: flex; gap: 10px;">
              <ion-button color="success" size="small" (click)="aceitarProjeto(notif)">
                <ion-icon slot="icon-only" name="checkmark"></ion-icon>
              </ion-button>
              <ion-button color="danger" size="small" (click)="recusarProjeto(notif)">
                <ion-icon slot="icon-only" name="close"></ion-icon>
              </ion-button>
            </div>
          </ion-item>
          
          <div *ngIf="(notificacoes$ | async)?.length === 0" class="ion-text-center ion-padding-top">
            <p style="color: var(--ion-color-medium);">Nenhuma notificação nova.</p>
          </div>
        </ion-list>
      </ion-content>
    </ng-template>
  </ion-modal>

</ion-content>